<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Weather App üçÉ</title>

  <link rel="icon" href="./Images/weather/64x64/night/356.png" type="images/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">


  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="./script.js"></script>
</head>

<body>

  <button onclick="topFunction()" id="myBtn" title="Go to top"><svg xmlns="https://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5"/>
  </svg></button>

  <script>

    let mybutton = document.getElementById("myBtn");


    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
      if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        mybutton.style.display = "block";
      } else {
        mybutton.style.display = "none";
      }
    }

    function topFunction() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
  </script>
  <!-- nav-bar -->

  <div class="nav-bar">
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container-fluid">
        <a class="navbar-brand" href="">
          <img src="./Images/tittleImage.png" width="30" height="30" class="d-inline-block align-top" alt="">
          Weather Book
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#"></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#weather-current">Current Weather</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#weather-forecast">Weather Forecast</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#map-t">Map</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#news-t">News</a>
            </li>
            <li class="nav-item float-end">
              <center>
                <div class="slider-t">
                  <label class="switch">
                    <input type="checkbox" id="myCheckbox" onchange="changeMode(this)">
                    <span class="slider round"></span>
                </div>
                <div class="dark" style="width: max-content;color: white;">Dark Mode</div>
                </label>
              </center>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
  <!-- nav-bar -->
  <!-- search-location -->

  <center>
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-sm-12">
          <div class="grid-item">
            <div class="current-div">
              <button id="btnCurrentLocation" class="btnCurrentLocation" type="submit" class="" style="color: red;"
                onclick="getLocation()">
                <img src="./Images/locationIcon.png" height="20px" width="auto"> &nbsp;&nbsp;Use Current</button>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-sm-12">
          <div class="grid-item">
            <div class="search-bar">
              <form class="form-inline my-2 my-lg-0" id="locationSubmitForm">
                <input class="form-control mr-sm-2" type="search" placeholder="Search location" aria-label="Search"
                  id="inputLocation">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit"
                  style="margin-left: 20px;">Search</button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>

  </center>
  <center>

  </center>
  <center>

  </center>
  <div class="view">
    <!-- search-location -->
    <!-- current-weather -->
    <div class="weather-current bg-black" id="weather-current">
      <h3 class="font-monospace text-white text-center p-2">üçÉ Current Weather üçÉ</h3>
    </div>
    <div class="border auto-weather-border">
      <div class="container">
        <div class="row">
          <div class="col-md-6 col-sm-12">
            <div class="grid-item">
              <div class="auto-weather">
                <div id="auto-location"></div>
                <div class="auto-location-temprature-img">
                  <img src="./Images/weather/64x64/day/113.png" id="auto-location-img" alt="">
                  <div class="auto-location-temprature" id="auto-location-temprature"></div>
                  <div class="change-temprature-c">
                    <button class="btn-change-temprature" id="btn-change-temprature-c"
                      onclick="updateTemperature('c')">C¬∞</button>
                  </div>
                  &nbsp; | &nbsp;
                  <div class="change-temprature-f">
                    <button class="btn-change-temprature" onclick="updateTemperature('f')"
                      id="btn-change-temprature-f">F¬∞</button>
                  </div>
                  <div class="auto-location-temprature" id="auto-location-temprature-f"></div>
                  <div class="conditions pt-1">
                    <div class="Precipitation condition-text" id="Precipitation">Precipitation:</div>
                    <div class="Humidity condition-text" id="Humidity">Humidity:</div>
                    <div class="Wind condition-text" id="Wind">Wind:</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-sm-12">
            <div class="grid-item float-md-end float-sm-start">
              <div class="demo">
                <div id="time-now" class="fs-2 fw-semibold"></div>
              </div>
              <div class="con">
                <div id="condition-text"></div>
              </div>
              <div class="demo">
                <div class="location" style="font-size: 10px;font-weight:bold;display: flex;">Location : &nbsp; <div
                    class="fw-normal float-end" id="location"></div>
                </div>
                <div class="country" style="font-size: 10px;font-weight:bold;display: flex;">Country : &nbsp;<div
                    class="fw-normal" id="country"></div>
                </div>
                <div class="region" style="font-size: 10px;font-weight:bold;display: flex;">Region : &nbsp;<div
                    class="fw-normal" id="region"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- current-weather -->
    <!-- forecaset-future -->
    <div class="weather-forecast bg-black mb-3" id="weather-forecast">
      <h3 class="font-monospace text-white text-center p-2">Weather Forecast Future</h3>
    </div>
    <center>
      <div class="border-future">
        <div id="forecast-future"></div>
      </div>
    </center>

    <!-- forecaset-future -->
    <!-- forecaset-history -->
    <div class="weather-forecast bg-black mb-3">
      <h3 class="font-monospace text-white text-center p-2">Weather Forecast History</h3>
    </div>
    <center>
      <form action="" id="weatherHistoryForm"
        style="border: 1px solid grey;padding: 20px;margin: 20px;border-radius: 20px;">
        <div class="inputDate">
          <div class="forecast-inputs">
            <label for="to">To: &nbsp;&nbsp;</label>
            <input type="date" id="to" name="to" required>
            <label for="end">End: &nbsp;&nbsp;</label>
            <input type="date" id="end" name="end" required>
          </div>
          <br>
        </div>
        <div class="searchBtn">
          <div class="forecast-inputs">
            <button type="submit" style="width: 200px;" class="btn btn-light border-1 border-dark">Search</button>
          </div>
        </div>
        <div class="error-div" id="error-div">
          <div class="out-put" id="out-put"></div>
        </div>
    </center>
    </form>
    <!-- forecaset-history -->
    <!-- map -->
    <div class="weather-forecast bg-black mb-3">
      <h3 class="font-monospace text-white text-center p-2" id="map-t">Map</h3>
    </div>
    <div class="div-map">
      <center>
        <div id="map" style="width: 70%;"></div>
      </center>
    </div>
    <!-- map -->
    <!-- news -->
    <div class="weather-forecast bg-black mb-3" id="news-t">
      <h3 class="font-monospace text-white text-center p-2">News</h3>
    </div>
  </div>

  <div class="container">
    <div class="row">

      <div class="col-md-3 col-sm-6">
        <div class="grid-item-1">
          <div class="container mt-3">
            <div class="card">
              <div class="card-header" style="background-color: red;color: white; font-weight: bold;">Flood Warning
              </div>
              <div class="card-body" style="margin: 0; padding: 0; height: 150px;"><img
                  src="./Images/backgroundImage.JPG" alt="" width="100%" height="100%"></div>

              <div class="card-header" style="background-color: red;color: white;font-weight: bold;">
                Areas : <label for=""
                  style="font-weight: normal;border: 1px solid black; padding: 5px;border-radius: 12px;background-color: black;">Calhoun</label>
              </div>
              <div class="card-footer">2021-01-05T21:47:00-05:00</div>
            </div>
          </div>

        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="grid-item-1">
          <div class="container mt-3">
            <div class="card">
              <div class="card-header" style="background-color: red;color: white; font-weight: bold;">Flood Warning
              </div>
              <div class="card-body" style="margin: 0; padding: 0; height: 150px;"><img
                  src="./Images/backgroundImage.JPG" alt="" width="100%" height="100%"></div>

              <div class="card-header" style="background-color: red;color: white;font-weight: bold;">
                Areas : <label for=""
                  style="font-weight: normal;border: 1px solid black; padding: 5px;border-radius: 12px;background-color: black;">Calhoun</label>
              </div>
              <div class="card-footer">2021-01-05T21:47:00-05:00</div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
  <footer>
    <center><span class="mb-3 mb-md-0 text-white">‰∏â HESHAN ‰∏â<br><br><br>¬© 2024</span></center>
  </footer>
</body>

<script>
  document.getElementById("locationSubmitForm").onsubmit = function (event) {
    event.preventDefault();
    let searchValue = document.getElementById('inputLocation').value;
    showSearchedLocation(searchValue);
  }

  //                ------Weather History-------
  document.getElementById("weatherHistoryForm").onsubmit = function (event) {
    event.preventDefault();
    let tempCurrentLocation = document.getElementById("auto-location").innerText;

    let toDate = document.getElementById('to').value;
    let endDate = document.getElementById('end').value;
    let today = new Date().toISOString().slice(0, 10);
    var tempToDate = new Date(toDate)
    var tempEndDate = new Date(endDate)
    var tempRangeDays = Math.floor((tempEndDate - tempToDate)) / (1000 * 60 * 60 * 24)

    if (endDate >= today) {
      document.getElementById("out-put").innerHTML = "End Date must be less than today's date"
      document.getElementById("out-put").style.color = "white"
      document.getElementById("out-put").style.backgroundColor = "red"
      document.getElementById("out-put").style.border = "2px solid red"
      document.getElementById("out-put").style.width = "fit-content"
      document.getElementById("out-put").style.padding = "10px"
      document.getElementById("out-put").style.borderRadius = "20px"
      document.getElementById("out-put").style.textAlign = "center"
      document.getElementById("out-put").style.transition = ".2s"
      document.getElementById("out-put").style.margin = "5px"
    }

    else if (toDate >= today) {
      document.getElementById("out-put").innerHTML = "To Date must be less than today's date"
      document.getElementById("out-put").style.color = "white"
      document.getElementById("out-put").style.backgroundColor = "red"
      document.getElementById("out-put").style.border = "2px solid red"
      document.getElementById("out-put").style.width = "fit-content"
      document.getElementById("out-put").style.padding = "10px"
      document.getElementById("out-put").style.borderRadius = "20px"
      document.getElementById("out-put").style.textAlign = "center"
      document.getElementById("out-put").style.transition = ".2s"
      document.getElementById("out-put").style.margin = "5px"
    }
    else if ((tempToDate.getFullYear() != tempEndDate.getFullYear()) || (tempToDate.getMonth() != tempEndDate.getMonth()) || ((tempRangeDays) > 7)) {
      document.getElementById("out-put").innerHTML = "Diiference should be 7 days"
      document.getElementById("out-put").style.color = "white"
      document.getElementById("out-put").style.backgroundColor = "red"
      document.getElementById("out-put").style.border = "2px solid red"
      document.getElementById("out-put").style.width = "fit-content"
      document.getElementById("out-put").style.padding = "10px"
      document.getElementById("out-put").style.borderRadius = "20px"
      document.getElementById("out-put").style.textAlign = "center"
      document.getElementById("out-put").style.transition = ".2s"
      document.getElementById("out-put").style.margin = "5px"
    }
    else if (toDate > endDate) {
      document.getElementById("out-put").innerHTML = "To Date must be less than End Date"
      document.getElementById("out-put").style.color = "white"
      document.getElementById("out-put").style.backgroundColor = "red"
      document.getElementById("out-put").style.border = "2px solid red"
      document.getElementById("out-put").style.width = "fit-content"
      document.getElementById("out-put").style.padding = "10px"
      document.getElementById("out-put").style.borderRadius = "20px"
      document.getElementById("out-put").style.textAlign = "center"
      document.getElementById("out-put").style.transition = ".2s"
      document.getElementById("out-put").style.margin = "5px"
    }
    else if (tempCurrentLocation == "") {
      document.getElementById("out-put").innerHTML = "Select Location first"
      document.getElementById("out-put").style.color = "white"
      document.getElementById("out-put").style.backgroundColor = "red"
      document.getElementById("out-put").style.border = "2px solid red"
      document.getElementById("out-put").style.width = "fit-content"
      document.getElementById("out-put").style.padding = "10px"
      document.getElementById("out-put").style.borderRadius = "20px"
      document.getElementById("out-put").style.textAlign = "center"
      document.getElementById("out-put").style.transition = ".2s"
      document.getElementById("out-put").style.margin = "5px"
      scrollToTop();
    }

    else {
      var outputDiv = document.getElementById("out-put");
      outputDiv.style = '';
      outputDiv.style.transition = ".7s";
      outputDiv.innerHTML = "";
      outputDiv.style.borderCollapse = "collapse";
      outputDiv.style.margin = "20px";

      var containerDiv = document.createElement("div");
      containerDiv.className = "table-container";
      containerDiv.style.overflow = "auto";
      containerDiv.style.maxHeight = "300px";

      var table = document.createElement("table");
      table.className = "weather-table";

      fetch(`https://api.weatherapi.com/v1/history.json?key=${key}&q=${tempCurrentLocation}&dt=${toDate}&end_dt=${endDate}`)
        .then(response => response.json())
        .then(data => {
          var headerRow = table.insertRow();
          headerRow.className = "header-row";

          var dataRow1 = table.insertRow();
          dataRow1.className = "data-row";

          var dataRow2 = table.insertRow();
          dataRow2.className = "data-row";

          for (var i = 0; i < tempRangeDays; i++) {
            var header = headerRow.insertCell(i);
            header.innerHTML = data["forecast"]["forecastday"][i]["date"];
            header.className = "header-cell";

            var cell1 = dataRow1.insertCell(i);
            cell1.className = "data-cell";
            var img = document.createElement("img");
            img.src = data["forecast"]["forecastday"][i]["day"]["condition"]["icon"];
            cell1.appendChild(img);

            var cell2 = dataRow2.insertCell(i);
            cell2.className = "data-cell";
            cell2.innerHTML = data["forecast"]["forecastday"][i]["day"]["condition"]["text"];
            cell2.style.fontSize = "10px";
          }
          containerDiv.appendChild(table);
          outputDiv.appendChild(containerDiv);
        });
    }
  }

</script>

</html>
